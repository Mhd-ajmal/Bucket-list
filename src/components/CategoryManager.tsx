import { useState } from 'react';
import { X, Plus, Edit, Trash2 } from 'lucide-react';
import { useWishlist } from '@/contexts/WishlistContext';
import { Category } from '@shared/schema';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { useToast } from '@/hooks/use-toast';

interface CategoryManagerProps {
  isOpen: boolean;
  onClose: () => void;
}

interface CategoryFormData {
  name: string;
  emoji: string;
}

export function CategoryManager({ isOpen, onClose }: CategoryManagerProps) {
  const { categories, wishlistItems, addCategory, updateCategory, deleteCategory } = useWishlist();
  const { toast } = useToast();

  const [editingCategory, setEditingCategory] = useState<Category | null>(null);
  const [showAddForm, setShowAddForm] = useState(false);
  const [formData, setFormData] = useState<CategoryFormData>({
    name: '',
    emoji: 'ğŸ“',
  });

  const getCategoryItemCount = (categoryId: string) => {
    return wishlistItems.filter(item => item.categoryId === categoryId).length;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!formData.name.trim()) {
      toast({
        title: "Name required",
        description: "Please enter a category name",
        variant: "destructive",
      });
      return;
    }

    try {
      if (editingCategory) {
        await updateCategory(editingCategory.id, formData);
        toast({
          title: "Category updated",
          description: "Category has been updated successfully",
        });
      } else {
        await addCategory({ ...formData, isDefault: false });
        toast({
          title: "Category added",
          description: "New category has been added successfully",
        });
      }

      resetForm();
    } catch (error) {
      toast({
        title: "Error",
        description: "Failed to save category. Please try again.",
        variant: "destructive",
      });
    }
  };

  const handleEdit = (category: Category) => {
    setEditingCategory(category);
    setFormData({
      name: category.name,
      emoji: category.emoji,
    });
    setShowAddForm(true);
  };

  const handleDelete = async (category: Category) => {
    const itemCount = getCategoryItemCount(category.id);
    
    let confirmMessage = `Are you sure you want to delete "${category.name}"?`;
    if (itemCount > 0) {
      confirmMessage += ` This will also delete ${itemCount} item${itemCount > 1 ? 's' : ''} in this category.`;
    }

    if (confirm(confirmMessage)) {
      try {
        await deleteCategory(category.id);
        toast({
          title: "Category deleted",
          description: "Category has been deleted successfully",
        });
      } catch (error) {
        toast({
          title: "Error",
          description: "Failed to delete category. Please try again.",
          variant: "destructive",
        });
      }
    }
  };

  const resetForm = () => {
    setFormData({ name: '', emoji: 'ğŸ“' });
    setEditingCategory(null);
    setShowAddForm(false);
  };

  const handleClose = () => {
    resetForm();
    onClose();
  };

  // Common emojis for quick selection
  const commonEmojis = [
    // Smileys & People
    'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ¤£', 'ğŸ˜‚', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ« ', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©', 'ğŸ˜˜', 'ğŸ˜—', 'â˜ºï¸',
    'ğŸ˜š', 'ğŸ˜™', 'ğŸ¥²', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ˜', 'ğŸ¤‘', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ«¢', 'ğŸ«£', 'ğŸ¤«', 'ğŸ¤”', 'ğŸ«¡', 'ğŸ¤', 'ğŸ¤¨', 'ğŸ˜', 'ğŸ˜‘',
    'ğŸ˜¶', 'ğŸ«¥', 'ğŸ˜¶â€ğŸŒ«ï¸', 'ğŸ˜', 'ğŸ˜’', 'ğŸ™„', 'ğŸ˜¬', 'ğŸ˜®â€ğŸ’¨', 'ğŸ¤¥', 'ğŸ«¨', 'ğŸ˜Œ', 'ğŸ˜”', 'ğŸ˜ª', 'ğŸ¤¤', 'ğŸ˜´', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•', 'ğŸ¤¢','ğŸ¥¹',
    'ğŸ¤®', 'ğŸ¤§', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ¥´', 'ğŸ˜µ', 'ğŸ˜µâ€ğŸ’«', 'ğŸ¤¯', 'ğŸ¤ ', 'ğŸ¥³', 'ğŸ¥¸', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§', 'ğŸ˜•', 'ğŸ«¤', 'ğŸ˜Ÿ', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜®',
    'ğŸ˜¯', 'ğŸ˜²', 'ğŸ˜³', 'ğŸ¥º', 'ğŸ¥¹', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜±', 'ğŸ˜–', 'ğŸ˜£', 'ğŸ˜', 'ğŸ˜“', 'ğŸ˜©', 'ğŸ˜«', 'ğŸ¥±',
    
    // Animals & Nature
    'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ»â€â„ï¸', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ½', 'ğŸ¸', 'ğŸµ', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š',
    'ğŸ’', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ£', 'ğŸ¥', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸª±', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ',
    'ğŸ', 'ğŸœ', 'ğŸª°', 'ğŸª²', 'ğŸª³', 'ğŸ¦Ÿ', 'ğŸ¦—', 'ğŸ•·ï¸', 'ğŸ•¸ï¸', 'ğŸ¦‚', 'ğŸ¢', 'ğŸ', 'ğŸ¦', 'ğŸ¦–', 'ğŸ¦•', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦€',
    'ğŸ¡', 'ğŸ ', 'ğŸŸ', 'ğŸ¬', 'ğŸ³', 'ğŸ‹', 'ğŸ¦ˆ', 'ğŸª¸', 'ğŸŠ', 'ğŸ…', 'ğŸ†', 'ğŸ¦“', 'ğŸ«', 'ğŸ¦', 'ğŸ¦§', 'ğŸ¦£', 'ğŸ˜', 'ğŸ¦›', 'ğŸ¦', 'ğŸª',
    'ğŸ«', 'ğŸ¦’', 'ğŸ¦˜', 'ğŸ¦¬', 'ğŸƒ', 'ğŸ‚', 'ğŸ„', 'ğŸ', 'ğŸ–', 'ğŸ', 'ğŸ‘', 'ğŸ¦™', 'ğŸ', 'ğŸ¦Œ', 'ğŸ•', 'ğŸ©', 'ğŸ¦®', 'ğŸ•â€ğŸ¦º', 'ğŸˆ', 'ğŸˆâ€â¬›',
    
    // Food & Drink
    'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸ«', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…', 'ğŸ†', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥¬',
    'ğŸ¥’', 'ğŸŒ¶ï¸', 'ğŸ«‘', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ«’', 'ğŸ§„', 'ğŸ§…', 'ğŸ¥”', 'ğŸ ', 'ğŸ«˜', 'ğŸ¥', 'ğŸ¥–', 'ğŸ', 'ğŸ¥¨', 'ğŸ¥¯', 'ğŸ§€', 'ğŸ¥š', 'ğŸ³', 'ğŸ§ˆ',
    'ğŸ¥', 'ğŸ§‡', 'ğŸ¥“', 'ğŸ¥©', 'ğŸ—', 'ğŸ–', 'ğŸ¦´', 'ğŸŒ­', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸ«“', 'ğŸ¥ª', 'ğŸ¥™', 'ğŸ§†', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ«”', 'ğŸ¥—', 'ğŸ¥˜',
    'ğŸ«•', 'ğŸ¥«', 'ğŸ', 'ğŸœ', 'ğŸ²', 'ğŸ›', 'ğŸ£', 'ğŸ±', 'ğŸ¥Ÿ', 'ğŸ¦ª', 'ğŸ¤', 'ğŸ™', 'ğŸš', 'ğŸ˜', 'ğŸ¥', 'ğŸ¥ ', 'ğŸ¥®', 'ğŸ¢', 'ğŸ¡', 'ğŸ§',
    'ğŸ¨', 'ğŸ¦', 'ğŸ¥§', 'ğŸ§', 'ğŸ‚', 'ğŸ°', 'ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ¿', 'ğŸ©', 'ğŸª', 'ğŸŒ°', 'ğŸ¥œ', 'ğŸ¯', 'ğŸ¥›', 'ğŸ¼', 'ğŸ«–', 'â˜•',
    
    // Travel & Places
    'ğŸš—', 'ğŸš•', 'ğŸš™', 'ğŸšŒ', 'ğŸš', 'ğŸï¸', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸš', 'ğŸ›»', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸï¸', 'ğŸ›µ', 'ğŸš²', 'ğŸ›´', 'ğŸ›¹', 'ğŸ›¼',
    'ğŸš', 'ğŸ›¸', 'âœˆï¸', 'ğŸ›©ï¸', 'ğŸ›«', 'ğŸ›¬', 'ğŸª‚', 'ğŸ’º', 'ğŸš€', 'ğŸ›°ï¸', 'ğŸš¢', 'â›µ', 'ğŸš¤', 'ğŸ›¥ï¸', 'ğŸ›³ï¸', 'â›´ï¸', 'ğŸš‚', 'ğŸšƒ', 'ğŸš„', 'ğŸš…',
    'ğŸš†', 'ğŸš‡', 'ğŸšˆ', 'ğŸš‰', 'ğŸšŠ', 'ğŸš', 'ğŸš', 'ğŸš‹', 'ğŸšŒ', 'ğŸš', 'ğŸš', 'ğŸš', 'ğŸš‘', 'ğŸš’', 'ğŸš“', 'ğŸš”', 'ğŸš•', 'ğŸš–', 'ğŸš—', 'ğŸš˜',
    'ğŸ ', 'ğŸ¡', 'ğŸ˜ï¸', 'ğŸšï¸', 'ğŸ—ï¸', 'ğŸ­', 'ğŸ¢', 'ğŸ¬', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ¨', 'ğŸª', 'ğŸ«', 'ğŸ©', 'ğŸ’’', 'ğŸ›ï¸', 'â›ª', 'ğŸ•Œ',
    'ğŸ›•', 'ğŸ•', 'â›©ï¸', 'ğŸ•‹', 'â›²', 'â›º', 'ğŸŒ', 'ğŸŒƒ', 'ğŸ™ï¸', 'ğŸŒ„', 'ğŸŒ…', 'ğŸŒ†', 'ğŸŒ‡', 'ğŸŒ‰', 'â™¨ï¸', 'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ’ˆ', 'ğŸª',
    
    // Objects & Technology
    'ğŸ“±', 'ğŸ’»', 'ğŸ–¥ï¸', 'ğŸ–¨ï¸', 'âŒ¨ï¸', 'ğŸ–±ï¸', 'ğŸ–²ï¸', 'ğŸ’½', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ“¼', 'ğŸ“·', 'ğŸ“¸', 'ğŸ“¹', 'ğŸ¥', 'ğŸ“½ï¸', 'ğŸï¸', 'ğŸ“', 'â˜ï¸',
    'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“º', 'ğŸ“»', 'ğŸ™ï¸', 'ğŸšï¸', 'ğŸ›ï¸', 'ğŸ§­', 'â±ï¸', 'â²ï¸', 'â°', 'ğŸ•°ï¸', 'âŒ›', 'â³', 'ğŸ“¡', 'ğŸ”‹', 'ğŸª«', 'ğŸ”Œ', 'ğŸ’¡', 'ğŸ”¦',
    'ğŸ•¯ï¸', 'ğŸª”', 'ğŸ§¯', 'ğŸ›¢ï¸', 'ğŸ’¸', 'ğŸ’µ', 'ğŸ’´', 'ğŸ’¶', 'ğŸ’·', 'ğŸª™', 'ğŸ’°', 'ğŸ’³', 'ğŸ’', 'âš–ï¸', 'ğŸªœ', 'ğŸ§°', 'ğŸª›', 'ğŸ”§', 'ğŸ”¨', 'âš’ï¸',
    'ğŸ› ï¸', 'â›ï¸', 'ğŸªš', 'ğŸ”©', 'âš™ï¸', 'ğŸª¤', 'ğŸ§²', 'ğŸ”«', 'ğŸ’£', 'ğŸ§¨', 'ğŸª“', 'ğŸ”ª', 'ğŸ—¡ï¸', 'âš”ï¸', 'ğŸ›¡ï¸', 'ğŸš¬', 'âš°ï¸', 'ğŸª¦', 'âš±ï¸', 'ğŸº',
    'ğŸ”®', 'ğŸ“¿', 'ğŸ§¿', 'ğŸª¬', 'ğŸ’ˆ', 'âš—ï¸', 'ğŸ”­', 'ğŸ”¬', 'ğŸ•³ï¸', 'ğŸ©¹', 'ğŸ©º', 'ğŸ’Š', 'ğŸ’‰', 'ğŸ©¸', 'ğŸ§¬', 'ğŸ¦ ', 'ğŸ§«', 'ğŸ§ª', 'ğŸŒ¡ï¸', 'ğŸ§¹',
    
    // Activities & Sports
    'âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¥', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ¥', 'ğŸ±', 'ğŸª€', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ‘', 'ğŸ¥', 'ğŸ', 'ğŸªƒ', 'ğŸ¥…', 'â›³',
    'ğŸª', 'ğŸ¹', 'ğŸ£', 'ğŸ¤¿', 'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ½', 'ğŸ›¹', 'ğŸ›¼', 'ğŸ›·', 'â›¸ï¸', 'ğŸ¥Œ', 'ğŸ¿', 'â›·ï¸', 'ğŸ‚', 'ğŸª‚', 'ğŸ‹ï¸', 'ğŸ¤¼', 'ğŸ¤¸', 'â›¹ï¸',
    'ğŸ¤º', 'ğŸ¤¾', 'ğŸŒï¸', 'ğŸ‡', 'ğŸ§˜', 'ğŸƒ', 'ğŸš¶', 'ğŸ§', 'ğŸ§', 'ğŸ¤¹', 'ğŸª', 'ğŸ­', 'ğŸ©°', 'ğŸ¨', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸ¼', 'ğŸµ', 'ğŸ¶',
    'ğŸª˜', 'ğŸ¥', 'ğŸª‡', 'ğŸ·', 'ğŸº', 'ğŸª—', 'ğŸ¸', 'ğŸª•', 'ğŸ»', 'ğŸ¹', 'ğŸªˆ', 'ğŸ²', 'â™ ï¸', 'â™¦ï¸', 'â™£ï¸', 'â™Ÿï¸', 'ğŸƒ', 'ğŸ€„', 'ğŸ´',
    'ğŸ¯', 'ğŸ®', 'ğŸ•¹ï¸', 'ğŸ°', 'ğŸ§©', 'ğŸ§¸', 'ğŸª…', 'ğŸª©', 'ğŸª†', 'ğŸ–¼ï¸', 'ğŸ§µ', 'ğŸª¡', 'ğŸ§¶', 'ğŸª¢', 'ğŸ‘“', 'ğŸ•¶ï¸', 'ğŸ¥½', 'ğŸ¥¼', 'ğŸ¦º',
    
    // Heart & Love
    'â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ–¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ’”', 'â£ï¸', 'ğŸ’•', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’Ÿ', 'â™¥ï¸',
    'ğŸ©µ','â¤ï¸â€ğŸ©¹', 'â¤ï¸â€ğŸ”¥', 'ğŸ©¶', 'ğŸ©·', 
    
    // Symbols & Misc
    'ğŸ”´', 'ğŸŸ ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸ”µ', 'ğŸŸ£', 'âš«', 'âšª', 'ğŸŸ¤', 'ğŸ”º', 'ğŸ”»', 'ğŸ”¸', 'ğŸ”¹', 'ğŸ”¶', 'ğŸ”·', 'ğŸ”³', 'ğŸ”²', 'â–ªï¸', 'â–«ï¸', 'â—¾',
    'â—½', 'â—¼ï¸', 'â—»ï¸', 'ğŸŸ¥', 'ğŸŸ§', 'ğŸŸ¨', 'ğŸŸ©', 'ğŸŸ¦', 'ğŸŸª', 'â¬›', 'â¬œ', 'ğŸŸ«', 'ğŸ”ˆ', 'ğŸ”‡', 'ğŸ”‰', 'ğŸ”Š', 'ğŸ“¢', 'ğŸ“£', 'ğŸ“¯', 'ğŸ””',
    'ğŸ”•', 'ğŸ’¤', 'â­', 'ğŸŒŸ', 'âœ¨', 'âš¡', 'â˜„ï¸', 'ğŸ’¥', 'ğŸ”¥', 'ğŸŒªï¸', 'ğŸŒˆ', 'â˜€ï¸', 'ğŸŒ¤ï¸', 'â›…', 'ğŸŒ¦ï¸', 'ğŸŒ§ï¸', 'â›ˆï¸',
    'ğŸŒ©ï¸', 'ğŸŒ¨ï¸', 'â„ï¸', 'â˜ƒï¸', 'â›„', 'ğŸŒ¬ï¸', 'ğŸ’¨', 'ğŸ’§', 'ğŸ’¦', 'ğŸ«§', 'â˜”', 'â˜‚ï¸', 'ğŸŒŠ', 'ğŸŒ«ï¸', 'ğŸ€', 'ğŸŒ±', 'ğŸŒ¿', 'ğŸƒ', 'ğŸŒ¾', 'ğŸŒµ',
    'ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸªµ', 'ğŸŒ•', 'ğŸŒ–', 'ğŸŒ—', 'ğŸŒ˜', 'ğŸŒ‘', 'ğŸŒ’', 'ğŸŒ“', 'ğŸŒ”', 'ğŸŒ™', 'ğŸŒ›', 'ğŸŒœ', 'ğŸŒš', 'ğŸŒ', 'ğŸŒ', 'ğŸª'
  ];

  return (
    <Dialog open={isOpen} onOpenChange={handleClose}>
      <DialogContent className="w-full max-w-md max-h-[80vh] overflow-y-auto" data-testid="category-manager-modal">
        <DialogHeader>
          <DialogTitle className="text-xl font-semibold text-gray-900 dark:text-white">
            Manage Categories
          </DialogTitle>
        </DialogHeader>
        
        <div className="space-y-6">
          {/* Add/Edit Form */}
          {showAddForm && (
            <form onSubmit={handleSubmit} className="p-4 bg-gray-50 dark:bg-slate-700 rounded-lg space-y-4" data-testid="category-form">
              <div>
                <Label htmlFor="category-name" className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Category Name *
                </Label>
                <Input
                  id="category-name"
                  type="text"
                  value={formData.name}
                  onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                  placeholder="Enter category name"
                  required
                  data-testid="input-category-name"
                />
              </div>

              <div>
                <Label className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Emoji Icon
                </Label>
                <div className="flex items-center space-x-2 mb-2">
                  <Input
                    type="text"
                    value={formData.emoji}
                    onChange={(e) => setFormData(prev => ({ ...prev, emoji: e.target.value }))}
                    className="w-16 text-center text-lg"
                    placeholder="ğŸ“"
                    data-testid="input-category-emoji"
                  />
                  <span className="text-sm text-gray-500 dark:text-gray-400">
                    Or click below to select
                  </span>
                </div>
                
                <div className="grid grid-cols-12 gap-1 max-h-40 overflow-y-auto border rounded-md p-2 bg-white dark:bg-slate-800">
                  {commonEmojis.map((emoji) => (
                    <button
                      key={emoji}
                      type="button"
                      onClick={() => setFormData(prev => ({ ...prev, emoji }))}
                      className={`w-6 h-6 text-sm rounded hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors ${
                        formData.emoji === emoji ? 'bg-primary-100 dark:bg-primary-900' : ''
                      }`}
                      data-testid={`emoji-${emoji}`}
                    >
                      {emoji}
                    </button>
                  ))}
                </div>
                <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  Scroll to see more emojis â€¢ {commonEmojis.length} available
                </p>
              </div>

              <div className="flex space-x-2">
                <Button
                  type="button"
                  variant="outline"
                  onClick={resetForm}
                  className="flex-1"
                  data-testid="button-cancel-category"
                >
                  Cancel
                </Button>
                <Button
                  type="submit"
                  className="flex-1 bg-primary-500 hover:bg-primary-600 text-white"
                  data-testid="button-save-category"
                >
                  {editingCategory ? 'Update' : 'Add'}
                </Button>
              </div>
            </form>
          )}

          {/* Categories List */}
          <div className="space-y-3">
            {categories.map((category) => {
              const itemCount = getCategoryItemCount(category.id);
              return (
                <div
                  key={category.id}
                  className="flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-700 rounded-lg theme-transition"
                  data-testid={`category-item-${category.id}`}
                >
                  <div className="flex items-center space-x-3">
                    <span className="text-2xl" data-testid={`category-emoji-${category.id}`}>
                      {category.emoji}
                    </span>
                    <div>
                      <h3 className="font-medium text-gray-900 dark:text-white" data-testid={`category-name-${category.id}`}>
                        {category.name}
                      </h3>
                      <p className="text-sm text-gray-500 dark:text-gray-400" data-testid={`category-count-${category.id}`}>
                        {itemCount} {itemCount === 1 ? 'item' : 'items'}
                      </p>
                    </div>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => handleEdit(category)}
                      className="text-primary-500 hover:text-primary-600 p-2"
                      data-testid={`button-edit-category-${category.id}`}
                    >
                      <Edit className="w-4 h-4" />
                    </Button>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => handleDelete(category)}
                      className="text-red-500 hover:text-red-600 p-2"
                      data-testid={`button-delete-category-${category.id}`}
                    >
                      <Trash2 className="w-4 h-4" />
                    </Button>
                  </div>
                </div>
              );
            })}
          </div>

          {!showAddForm && (
            <Button
              onClick={() => setShowAddForm(true)}
              className="w-full bg-primary-500 hover:bg-primary-600 text-white"
              data-testid="button-add-category"
            >
              <Plus className="w-4 h-4 mr-2" />
              Add New Category
            </Button>
          )}
        </div>
      </DialogContent>
    </Dialog>
  );
}
